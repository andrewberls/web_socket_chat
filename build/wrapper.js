// Generated by CoffeeScript 1.3.3
var SocketWrapper;

SocketWrapper = Backbone.Model.extend({
  defaults: {
    connected: false
  },
  connect: function() {
    var url,
      _this = this;
    if (window.socket && socket.readyState === 1) {
      console.log("Already connected");
      return;
    }
    url = "ws://" + (this.get('host')) + ":" + (this.get('port'));
    console.log("Connecting to " + url);
    window.socket = new WebSocket(url);
    this.set({
      connected: true
    });
    socket.onmessage = function(msg) {
      var response;
      try {
        response = JSON.parse(msg.data);
      } catch (ex) {
        _this.trigger('socket:parse_error', "Could not parse message from socket: " + msg.data);
      }
      if (response.type === "Connect") {
        return _this.trigger('socket:connect', response['data']);
      } else {
        return _this.trigger('socket:message', response['data'], response['type']);
      }
    };
    socket.onerror = function(evt) {
      this.set({
        connected: false
      });
      return this.trigger('socket:error');
    };
    return socket.onclose = function(evt) {
      this.set({
        connected: false
      });
      return console.log("Closing: " + evt);
    };
  },
  disconnect: function() {
    if (window.socket && socket.readyState === 1) {
      console.log("Disconnecting");
      window.socket.close();
      return this.set({
        connected: false
      });
    }
  }
});
